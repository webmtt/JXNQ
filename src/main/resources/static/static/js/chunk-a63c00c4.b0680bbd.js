(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a63c00c4"],{"4a58":function(e,t,n){"use strict";var r=n("e48d"),i=n.n(r);i.a},"50a8":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"map"}},[n("time-player")],1)},i=[],a=n("88d6"),s=(n("06a2"),n("e10e"),n("9dd9"),n("6d57"),n("4360")),c=n("b45c"),o=n.n(c),u=n("ed08"),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.times.length?n("div",{staticClass:"playBox"},[e.years.length?n("div",{staticClass:"activeYear"},[n("el-dropdown",{on:{change:e.yearChanged}},[n("span",{staticStyle:{color:"#fff"}},[e._v("\n                "+e._s(e.activeYear)),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.years,(function(t,r){return n("el-dropdown-item",{key:r},[e._v(e._s(t.value))])})),1)],1)],1):e._e(),e._v(" "),n("div",{staticClass:"toggleButton",on:{click:e.togglePlay}},[n("i",{class:{"el-icon-video-pause":e.status,"el-icon-video-play":!e.status}})]),e._v(" "),n("div",{staticClass:"timeLine"},e._l(e.times,(function(t,r){return n("el-tooltip",{key:r,attrs:{effect:"dark",content:t,placement:"top"}},[n("div",{class:{timeBar:!0,defaultBg:r!=e.currentIndex,activeBg:r==e.currentIndex},on:{click:function(t){return e.timeLineTabChange(r)}}},[n("span",{staticStyle:{position:"absolute",bottom:"10px",color:"#17cdbd"}},[e._v(e._s(e.getPeriod(t.split("_")[0],t.split("_")[2],t.split("_")[3])))])])])})),1)]):e._e()},l=[],p=(n("5ab2"),n("9a33"),n("52c1"));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={name:"timePlayer",data:function(){return{status:!1,currentIndex:0,timer:null,activeYear:"2019",times:[],isMonthPlay:!1,years:[]}},watch:{playLayers:{handler:function(e){this.times=e,this.stop(),this.currentIndex=0},immediate:!0},playerYears:{handler:function(e){console.log(e),this.years=e},immediate:!0},"$route.path":function(){this.stop(),this.currentIndex=0},currentIndex:function(e){this.$store.dispatch("map/changeActiveLayers",{key:"showLayers",value:[this.times[e]]})}},computed:d({},Object(p["c"])("map",["lengendLayers","playLayers","playerYears","businessLayers"])),methods:{getPeriod:function(e,t,n){if("/growManage"!==this.$route.path)return"";var r=parseInt(t),i=parseInt(n);if("油菜"===e){if(9===r&&i>=20||10==r&&i<=1)return"播种期";if(10===r&&i>=2||12==r&&i<=28||11===r)return"苗期";if(12===r&&i>=29||1==r&&i<=26)return"蕾苔期";if(1===r&&i>=27||3==r&&i<=1||2===r)return"移栽/开花期";if(3===r&&i>=2&&i<=31)return"角果发育成熟期";if(4===r&&i>=1&&i<=28)return"收割期"}else if("小麦"===e){if(10===r&&i>=12&&i<=22)return"播种期";if(10===r&&i>=23||11==r&&i<=15)return"出苗期";if(11===r&&i>=16&&i<=31)return"分蘖期";if(12===r&&i>=1||1==r&&i<=25)return"越冬期";if(1===r&&i>=26||2==r&&i<=26)return"返青期";if(2===r&&i>=27||3==r&&i<=25)return"拔节期";if(3===r&&i>=26||4==r&&i<=1)return"孕穗期";if(4===r&&i>=2&&i<=12)return"抽穗期";if(4===r&&i>=13&&i<=30)return"开花期";if(4===r&&i>=31||5==r&&i<=6)return"灌浆期";if(5===r&&i>=7&&i<=15)return"成熟期";if(16===r&&i>=7&&i<=24)return"收割期"}else{if(5===r&&i>=25||6==r&&i<=5)return"播种期";if(6===r&&i>=6||7==r&&i<=26)return"分蘖/移栽期";if(7===r&&i>=27||8==r&&i<=31)return"拔节期";if(9===r&&i>=1&&i<=19)return"抽穗期";if(9===r&&i>=20&&i<=30)return"乳熟期";if(9===r&&i>=31||10==r&&i<=23)return"收割期"}return""},stop:function(){this.status=!1,this.timer&&window.clearInterval(this.timer)},togglePlay:function(){var e=this;if(this.status=!this.status,!this.status)return this.stop();this.timer=setInterval((function(){e.currentIndex++,e.currentIndex=e.currentIndex%e.times.length}),2500)},timeLineTabChange:function(e){this.stop(),this.currentIndex=e},yearChanged:function(e){var t=this,n=this.businessLayers.filter((function(t){return t.split("_")[1]===e}));this.$store.dispatch("map/changePlayYears",{key:"playerYears",value:n}).then((function(e){t.$store.dispatch("map/changeActiveLayers",{key:"showLayers",value:[n[0]]})}))}}},y=m,v=(n("5a16"),n("4023")),b=Object(v["a"])(y,f,l,!1,null,"d6fb48fc",null),g=b.exports,L=n("5c1c"),w=n("20b9"),S={data:function(){return{currentScence:null,map:null,toolCtrl:null,specialScenceInfos:{}}},components:{timePlayer:g},computed:{showLayers:function(){return this.$store.state.map.showLayers},businessLayers:function(){return this.$store.state.map.businessLayers}},watch:{"$route.path":function(e,t){this.changeScene(L["b"][this.$route.path.slice(1)])},showLayers:{handler:function(e,t){this.map&&this.setActiveLayers(e,t)},deep:!0,immediate:!0}},methods:{getAllLoadedMapLayers:function(){return this.map.getStyle().layers||[]},getNeedShowMapLayers:function(e){var t=this,n=[],r=[];return e.forEach((function(e){return n=n.concat(e.layers||e)})),n.forEach((function(e){var n=new RegExp(e);t.getAllLoadedMapLayers().forEach((function(e){return n.test(e.id)&&r.push(e)}))})),r},clearTimer:function(){this.loadTimer&&window.clearTimeout(this.loadTimer)},removeCurrentScenceLayersFromMap:function(){var e=this;if(this.currentScence){var t=this.specialScenceInfos[this.currentScence.scenceName].layers;t.forEach((function(t){return e.map.getLayer(t.id)&&e.map.removeLayer(t.id)}))}},resetScenceData:function(e){this.currentScence=Object(u["a"])(e),this.currentMapServerUrl=this.currentScence.scenceUrl},changeScene:function(e){var t=this;if(e&&this.currentMapServerUrl!=e.scenceUrl){this.removeCurrentScenceLayersFromMap(),this.resetScenceData(e);var n=this.specialScenceInfos[e.scenceName].sources;Object.keys(n).forEach((function(e){return!t.map.getSource(e)&&t.map.addSource(e,n[e])})),this.specialScenceInfos[e.scenceName].layers.forEach((function(e){return!t.map.getLayer(e.id)&&t.map.addLayer(e)}))}},setActiveLayers:function(e){var t=this,n=e,r=this.businessLayers.filter((function(e){return-1===n.indexOf(e)}));n.forEach((function(e){return t.map.getLayer(e)&&t.map.setLayoutProperty(e,"visibility","visible")})),r.forEach((function(e){return t.map.getLayer(e)&&t.map.setLayoutProperty(e,"visibility","none")}))},bindEventFromSubComponents:function(){var e=this;this.$bus.on("locationToPoint",(function(t){return e.map.flyTo({center:t.coordinates,zoom:t.zoom})})),this.$bus.emit("fatherComLoaded")},bindMapEvents:function(){var e=this;this.map.on("load",(function(){e.bindEventFromSubComponents(),w["a"].getInstance().addToMap(e.map)}))},initMap:function(){var e=this;this.map=new o.a.Map({container:"map",doubleClickZoom:!1,center:[120.8,30.67],zoom:9.1,style:L["a"].image}),Promise.all(Object.keys(L["b"]).map((function(e){return fetch(L["b"][e].scenceUrl).then((function(e){return e.json()})).then((function(t){return Object(a["a"])({},e,t)}))}))).then((function(t){t.forEach((function(t){var n=Object.keys(t)[0],r=t[n];e.specialScenceInfos[n]=r})),e.changeScene(L["b"][e.$route.path.slice(1)]),e.setActiveLayers(e.showLayers)})),s["a"].dispatch("app/setSysMap",this.map),this.bindMapEvents()}},mounted:function(){console.log("map loading"),this.initMap()},destroyed:function(){console.log("map die")}},O=S,j=(n("4a58"),Object(v["a"])(O,r,i,!1,null,"e483dc58",null));t["default"]=j.exports},"5a16":function(e,t,n){"use strict";var r=n("8ba8"),i=n.n(r);i.a},"8ba8":function(e,t,n){},"9dd9":function(e,t,n){var r=n("e7ad"),i=n("1e5b"),a=n("064e").f,s=n("2ea2").f,c=n("2fd4"),o=n("f1fe"),u=r.RegExp,f=u,l=u.prototype,p=/a/g,h=/a/g,d=new u(p)!==p;if(n("149f")&&(!d||n("238a")((function(){return h[n("cb3d")("match")]=!1,u(p)!=p||u(h)==h||"/a/i"!=u(p,"i")})))){u=function(e,t){var n=this instanceof u,r=c(e),a=void 0===t;return!n&&r&&e.constructor===u&&a?e:i(d?new f(r&&!a?e.source:e,t):f((r=e instanceof u)?e.source:e,r&&a?o.call(e):t),n?this:l,u)};for(var m=function(e){e in u||a(u,e,{configurable:!0,get:function(){return f[e]},set:function(t){f[e]=t}})},y=s(f),v=0;y.length>v;)m(y[v++]);l.constructor=u,u.prototype=l,n("bf16")(r,"RegExp",u)}n("1157")("RegExp")},e48d:function(e,t,n){}}]);